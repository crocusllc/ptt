{
    # Global options block. Entirely optional, https is on by default
    # Optional email key for lets encrypt

    email youremail@domain.com 
    
    # Optional staging lets encrypt for testing. Comment out for production.
    # acme_ca https://acme-staging-v02.api.letsencrypt.org/directory
}

(cors) {
    @cors_preflight method OPTIONS
    @cors header Origin {args.0}
  
    handle @cors_preflight {
      header Access-Control-Allow-Origin "{args.0}"
      header Access-Control-Allow-Methods "GET, POST, PUT, PATCH, DELETE"
      header Access-Control-Allow-Headers "Content-Type"
      header Access-Control-Max-Age "3600"
      respond "" 204
    }
  
    handle @cors {
      header Access-Control-Allow-Origin "{args.0}"
      header Access-Control-Expose-Headers "Link"
    }
}

localhost:443 {
    import cors localhost:443

    tls internal {
		  on_demand
	  }

    handle_path /db/* {
        reverse_proxy api:5000
    }

    reverse_proxy app:3000
}
